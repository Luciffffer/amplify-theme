<section class="my-48 lg:px-6 lg:mt-0" data-slide-container>
    <div class="max-w-[90rem] mx-auto aspect-[1/4] bg-black lg:bg-transparent lg:aspect-[1/1.5]" data-slide-sticky>

        <div class="h-screen bg-black sticky top-0 overflow-hidden lg:bg-transparent lg:flex lg:items-center">

            <div class="mx-auto relative h-full w-full lg:aspect-[16/9] lg:h-auto lg:bg-black flex items-center justify-center overflow-hidden">

                <div aria-hidden="true" class="h-full w-full aspect-square absolute top-0 left-0 overflow-hidden">
                    <div class="w-full h-full px-6">
                        <div class="relative w-full h-full max-w-7xl mx-auto">
                            <div class="w-[1000px] aspect-square absolute translate-x-1/2 translate-y-1/2 bottom-0 right-12 xl:right-[40%] xl:bottom-[20%]">
                                <div class="relative w-full h-full">
                                    <div class="w-full h-full bg-radial-gradient-hero blur-3xl"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative h-full w-full max-w-7xl lg:aspect-[16/9] lg:h-auto">

                    <h2 class="sr-only">Who we are</h2>

                    <div
                        class="uppercase font-heading font-bold text-[17vw] text-[#E8DBF8] opacity-25 whitespace-nowrap overflow-hidden absolute h-[23vw] flex top-6 pointer-events-none md:h-[14vw] md:text-[7vw] xl:rotate-90 xl:origin-bottom-left xl:-top-36 xl:h-auto xl:text-[8rem]" 
                        aria-hidden
                        data-scroll-move-left
                    >
                        <span class="h-[23vw] md:h-[14vw] flex gap-[5vw] md:gap-[3vw] items-center xl:h-24 xl:gap-10" style="transform: translateX(0%);">
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                    </div>

                    <div
                        class="uppercase font-heading font-bold text-[#E8DBF8] opacity-25 whitespace-nowrap overflow-hidden absolute pointer-events-none -rotate-90 origin-bottom-left -bottom-11 h-auto text-[8rem] left-full xl:flex hidden" 
                        aria-hidden
                        data-scroll-move-left
                    >
                        <span class="h-24 flex gap-10 items-center" style="transform: translateX(0%);">
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                    </div>

                    <div
                        class="uppercase font-heading font-bold text-[17vw] text-[#E8DBF8] opacity-25 whitespace-nowrap overflow-hidden absolute h-[23vw] flex bottom-6 pointer-events-none md:h-[14vw] md:text-[7vw] xl:hidden" 
                        aria-hidden
                        data-scroll-move-right
                    >
                        <span class="h-[23vw] md:h-[14vw] flex gap-[5vw] md:gap-[3vw] items-center" style="transform: translateX(-19%);">
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                            WHO WE 
                            <span class="font-extralight italic">
                                ARE
                            </span>
                    </div>

                    <div 
                        data-page-1 
                        class="text-white absolute top-1/2 -translate-y-1/2 px-6 w-full xl:grid xl:max-w-4xl xl:left-1/2 xl:-translate-x-1/2 about-introduction-translate"
                        style="grid-template-columns: 1.3fr 1fr"
                    >
                        
                        <div class="flex flex-col gap-9 max-w-xl mx-auto xl:gap-16">
                            <div class="flex flex-col gap-9">

                                <h3 class="font-heading text-heading-sm">Artists are central</h3>
                                <p>
                                    At Amplify, everything revolves around supporting artists and their music. We understand how challenging it can be for new and emerging artists to gain the attention they deserve in the competitive music world. This is where we provide a solution. <span class="text-primary-300">Amplify shines a spotlight on unknown talent</span> by offering them a platform where they can take center stage.
                                </p>

                            </div>
                            <a 
                                href="over"
                                class="font-button-base px-6 py-3 w-fit text-center text-black white-button-colors rounded-md font-medium flex items-center gap-3 stroke-black"
                            >
                                Read more
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 12L13 18M19 12L13 6M19 12L5 12" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </a>
                        </div>

                        <img 
                            src="<?php echo get_template_directory_uri(); ?>/assets/images/about-introduction-image.jpg" 
                            alt="A music artist playing the guitar"
                            class="aspect-[2/1] object-cover rounded-3xl absolute -right-[45%] -top-[10%] h-96 hidden xl:block"
                        >

                    </div>

                    <div data-page-2 class="absolute top-1/2 -translate-y-1/2 px-6 about-introduction-translate about-introduction-hidden w-full xl:max-w-4xl xl:left-1/2 xl:-translate-x-1/2">

                        <div class="aspect-[16/9] rounded-3xl overflow-hidden lg:max-h-96 mx-auto xl:max-h-none">
                            <div id="youtube-player"></div>
                        </div>

                    </div>

                    <div data-slide-control class="flex items-center absolute bottom-[15%] -translate-x-1/2 left-1/2 lg:bottom-[5%]">
                        <button
                            class="aspect-square w-5 group flex items-center justify-center"
                            aria-label="Select short introduction"
                            aria-selected="true"
                        >
                            <div class="aspect-square w-2 rounded-full bg-neutral-600 group-aria-selected:bg-white transition-colors duration-300"></div>
                        </button>
                        <button
                            class="aspect-square w-5 group flex items-center justify-center"
                            aria-label="Select long introduction"
                            aria-selected="false"
                        >
                            <div class="aspect-square w-2 rounded-full bg-neutral-600 group-aria-selected:bg-white transition-colors duration-300"></div>
                        </button>
                    </div>                

                </div>

            </div>

        </div>

    </div>
</section>

<script defer>

// youtube player
const youtubeApiScript = document.createElement('script');
youtubeApiScript.src = 'https://www.youtube.com/iframe_api';
document.head.appendChild(youtubeApiScript);

var player = null;
var playerReady = false;
function onYouTubeIframeAPIReady() {
    player = new YT.Player('youtube-player', {
        height: '100%',
        width: '100%',
        videoId: '758wNLIr_4k',
        playerVars: {
            'playsinline': 1
        },
        events: {
            'onReady': onPlayerReady
        }
    });
}

function onPlayerReady(event) {
    playerReady = true;
}

const slideContainer = document.querySelector('[data-slide-container]');
const slideSticky = document.querySelector('[data-slide-sticky]');
const slidePages = slideSticky.querySelectorAll('[data-page-1], [data-page-2]');
const slideControls = slideSticky.querySelectorAll('[data-slide-control] button');

const scrollMoveLeftElements = document.querySelectorAll('[data-scroll-move-left] > span');
const scrollMoveRight = document.querySelector('[data-scroll-move-right] > span');
const scrollMoveLefts = Array.from(scrollMoveLeftElements).map(el => {
    const trnslateX = el.style.transform.match(/-?\d+/);
    return {
        element: el,
        translateXLeft: trnslateX
    };
})
const translateXRight = scrollMoveRight.style.transform.match(/-?\d+/);

// check if slideContainer is at the top of the viewport after scroll
let isSticking = false;
let prevSelectedSlideNumber = 0;
let timeout;

window.addEventListener('scroll', () => {
    scrollText(window.scrollY);

    if (slideContainer.getBoundingClientRect().top <= 0 && slideContainer.getBoundingClientRect().bottom >= window.innerHeight) {
        isSticking = true;
    } else {
        isSticking = false;
    }

    // if scroll past midle of slideContainer, show page 2
    pageSelect(window.scrollY);
    
});

// show page 1 or 2 based on scroll position
function pageSelect(scrollY) {
    if (!isSticking) return;

    const slideContainerTop = slideContainer.getBoundingClientRect().top;
    const slideContainerHeight = slideContainer.getBoundingClientRect().height;

    const selectedSlideNumber = Math.round(Math.abs(slideContainerTop / slideContainerHeight * 100) / (100 / slidePages.length));

    if (selectedSlideNumber == prevSelectedSlideNumber) return;
    prevSelectedSlideNumber = selectedSlideNumber;
    timeout && clearTimeout(timeout);
    if (playerReady) player.pauseVideo();

    slidePages.forEach((el, index) => {
        if (index !== selectedSlideNumber) {
            el.classList.add('about-introduction-hidden');
        }
    });

    timeout = setTimeout(() => {
        slidePages[selectedSlideNumber].classList.remove('about-introduction-hidden'); 
    }, 700);

    slideControls.forEach((el, index) => {
        if (index === selectedSlideNumber) {
            el.setAttribute('aria-selected', 'true');
        } else {
            el.setAttribute('aria-selected', 'false');
        }
    });
}

// move scroll-move-left and scroll-move-right elements on scroll
function scrollText(scrollY) {
    if (isSticking) {

        const distanceToTop =  slideContainer.getBoundingClientRect().top;

        const newTranslateXLefts = scrollMoveLefts.map(el => {
            return (parseInt(el.translateXLeft[0]) + distanceToTop * 0.1) % (1/5 * 100);
        });
        let newTranslateXRight = (parseInt(translateXRight[0]) - distanceToTop * 0.1) % (1/5 * 100);

        newTranslateXRight = newTranslateXRight > 0 ? newTranslateXRight - (1/5 * 100) : newTranslateXRight;

        // set new translatex values
        scrollMoveLefts.forEach((el, index) => {
            el.element.style.transform = `translateX(${newTranslateXLefts[index]}%)`;
        });
        scrollMoveRight.style.transform = `translateX(${newTranslateXRight}%)`;
    }
}

// select page 1 or 2 based on slide control click
slideControls.forEach((el, index) => {
    el.addEventListener('click', () => {
        scrollToIndex(index);
    });
});

function scrollToIndex(index) {
    if (!Number.isInteger(index)) return;
    console.log("Scrolling to index", index);

    const slideTopScrollY = slideContainer.getBoundingClientRect().top + window.scrollY;
    const individualSlideHeight = slideContainer.getBoundingClientRect().height / slidePages.length;

    window.scrollTo({
        top: slideTopScrollY + individualSlideHeight * index,
        behavior: 'smooth'
    });
}

// url based page selection
const urlParams = new URLSearchParams(window.location.search);
const page = urlParams.get('slide');
if (page) {
    scrollToIndex(parseInt(page));
}


</script>